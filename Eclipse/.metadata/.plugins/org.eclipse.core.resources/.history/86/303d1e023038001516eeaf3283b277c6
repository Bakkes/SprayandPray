var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');

canvas.width=window.innerWidth;
canvas.height=window.innerWidth;

make_base();
function make_base(){
	base_image = new Image();
	base_image.src = 'images/16-9.jpg';
	base_image.onload = function(){
		context.drawImage(base_image, 0,0);
	}
}



//gun data
var ak = [[0,0],[-2,0],[-18,1],[-19,2],[-29,3],[-43,3],[-58,7],[-71,11],[-79,10],[-86,4],
            [-88,-8],[-89,-17],[-92,-24],[-93,-30],[-92,-33],[-93,-33],[-96,-24],[-98,-13],[-100,-1],[-99,12],
            [-99,18],[-98,20],[-98,19],[-101,18],[-103,19],[-104,20],[-104,19],[-103,11],[-102,-3],[-97,-21]]; 
var akFireRate = 10;

normalizer = 1.6
for(i = 0; i < ak.length;i++){
	for(j = 0;j<2;j++){
		ak[i][j] = ak[i][j] * normalizer
	}
}

//gun shit here
var i = 0;
var radius = 3;
var firing = false;
var sensitivity = 1.2;

var currentX = null;
var currentY = null;
var originX = null;
var originY = null;


//document.body.onmousedown = function() { 
//	  firing = true;
//}
//document.body.onmouseup = function() {
//	  firing = false;
//}
function onMouseUpdate(e){
	currentX = e.pageX;
	currentY = e.pageY;
}

var engage = function(e){
	firing = true;
	originX = e.pageX;
	originY = e.pageY;
	document.body.style.cursor = 'none';
}
setInterval( function() {fireBullet(currentX,currentY)}, 100 );


var fireBullet = function(x,y){
	if(firing){
		context.beginPath();
	    context.fillStyle = 'red';
		context.arc((sensitivity/2.63) * (x-originX)+originX - ak[i][1], (sensitivity/2.63) * (y-originY)+originY +ak[i][0], radius, 0, Math.PI*2);
		context.fill();
		var audio = new Audio('sounds/ak.mp3');
		audio.play();
		if(i < 29){
			i++;
		} else if (i == 29){
			i=0;
			firing = false;
			document.body.style.cursor = 'pointer';
		}
	}
}

var ceasefire = function(){
	firing = false ;
	document.body.style.cursor = 'pointer';
	i=0;

}

canvas.addEventListener('mousedown', engage);
canvas.addEventListener('mousemove', onMouseUpdate);
canvas.addEventListener('mouseup',ceasefire);

